(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{395:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"基本概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基本概念"}},[s._v("#")]),s._v(" 基本概念")]),s._v(" "),t("h2",{attrs:{id:"进程与线程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进程与线程"}},[s._v("#")]),s._v(" 进程与线程")]),s._v(" "),t("h3",{attrs:{id:"进程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进程"}},[s._v("#")]),s._v(" 进程")]),s._v(" "),t("ul",[t("li",[s._v("程序由指令和数据组成，但这些指令要运行，数据要读写，就必须将指令加载至 CPU，数据加载至内存。在\n指令运行过程中还需要用到磁盘、网络等设备。进程就是用来加载指令、管理内存、管理 IO 的")]),s._v(" "),t("li",[s._v("当一个程序被运行，从磁盘加载这个程序的代码至内存，这时就开启了一个进程。")]),s._v(" "),t("li",[s._v("进程就可以视为程序的一个实例。大部分程序可以同时运行多个实例进程（例如记事本、画图、浏览器\n等），也有的程序只能启动一个实例进程（例如网易云音乐、360 安全卫士等）\n")])]),s._v(" "),t("h3",{attrs:{id:"线程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#线程"}},[s._v("#")]),s._v(" 线程")]),s._v(" "),t("ul",[t("li",[s._v("一个进程之内可以分为一到多个线程。")]),s._v(" "),t("li",[s._v("一个线程就是一个指令流，将指令流中的一条条指令以一定的顺序交给 CPU 执行")]),s._v(" "),t("li",[s._v("Java 中，线程作为最小调度单位，进程作为资源分配的最小单位。 在 windows 中进程是不活动的，只是作\n为线程的容器")])]),s._v(" "),t("h3",{attrs:{id:"二者对比"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二者对比"}},[s._v("#")]),s._v(" 二者对比")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("进程基本上相互独立的，而线程存在于进程内，是进程的一个子集")])]),s._v(" "),t("li",[t("p",[s._v("进程拥有共享的资源，如内存空间等，供其内部的线程共享")])]),s._v(" "),t("li",[t("p",[s._v("进程间通信较为复杂")]),s._v(" "),t("ul",[t("li",[s._v("同一台计算机的进程通信称为 IPC（Inter-process communication）")]),s._v(" "),t("li",[s._v("不同计算机之间的进程通信，需要通过网络，并遵守共同的协议，例如 HTTP")])])]),s._v(" "),t("li",[t("p",[s._v("线程通信相对简单，因为它们共享进程内的内存，一个例子是多个线程可以访问同一个共享变量")])]),s._v(" "),t("li",[t("p",[s._v("线程更轻量，线程上下文切换成本一般上要比进程上下文切换低")])])]),s._v(" "),t("h3",{attrs:{id:"并行与并发"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#并行与并发"}},[s._v("#")]),s._v(" 并行与并发")]),s._v(" "),t("p",[s._v("单核 cpu 下，线程实际还是 "),t("font",{attrs:{color:"red"}},[t("strong",[s._v("串行执行")])]),s._v(" 的。操作系统中有一个组件叫做任务调度器，将 cpu 的时间片（windows\n下时间片最小约为 15 毫秒）分给不同的程序使用，只是由于 cpu 在线程间（时间片很短）的切换非常快，人类感\n觉是 "),t("strong",[t("font",{attrs:{color:"red"}},[s._v("同时运行的")])],1),s._v(" 。总结为一句话就是： "),t("strong",[t("font",{attrs:{color:"red"}},[s._v("微观串行，宏观并行")])],1),s._v("，")],1),s._v(" "),t("p",[s._v("一般会将这种 线程轮流使用 CPU 的做法称为并发， concurrent")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2022/01/11/GkFXg4ECHiedSnB.png",alt:"image-20220111140258851"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2022/01/11/7WExHYdZt2v9aOV.png",alt:"image-20220111140323919"}})]),s._v(" "),t("p",[s._v("多核 cpu下，每个 "),t("strong",[t("font",{attrs:{color:"red"}},[s._v("核（core）")])],1),s._v(" 都可以调度运行线程，这时候线程可以是并行的。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2022/01/11/V2JXjKQTxY3mPEB.png",alt:"image-20220111140406370"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2022/01/11/vjbQqyUFtkVPlCn.png",alt:"image-20220111140414819"}})]),s._v(" "),t("p",[s._v("引用 Rob Pike 的一段描述：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("并发（concurrent）是同一时间应对（dealing with）多件事情的能力")])]),s._v(" "),t("li",[t("p",[s._v("并行（parallel）是同一时间动手做（doing）多件事情的能力")])])]),s._v(" "),t("p",[s._v("例子")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("家庭主妇做饭、打扫卫生、给孩子喂奶，她一个人轮流交替做这多件事，这时就是并发")])]),s._v(" "),t("li",[t("p",[s._v("家庭主妇雇了个保姆，她们一起这些事，这时既有并发，也有并行（这时会产生竞争，例如锅只有一口，一\n个人用锅时，另一个人就得等待）")])]),s._v(" "),t("li",[t("p",[s._v("雇了3个保姆，一个专做饭、一个专打扫卫生、一个专喂奶，互不干扰，这时是并行")])])]),s._v(" "),t("blockquote",[t("p",[s._v("Rob Pike 资料")]),s._v(" "),t("ul",[t("li",[s._v("golang 语言的创造者")]),s._v(" "),t("li",[s._v("Rob Pike - 百度百科")])])]),s._v(" "),t("h3",{attrs:{id:"应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#应用"}},[s._v("#")]),s._v(" 应用")]),s._v(" "),t("h3",{attrs:{id:"应用之异步调用-案例1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#应用之异步调用-案例1"}},[s._v("#")]),s._v(" "),t("strong",[t("font",{attrs:{color:"red"}},[s._v("应用之异步调用（案例1)")])],1)]),s._v(" "),t("p",[s._v("以调用方角度来讲，如果")]),s._v(" "),t("ul",[t("li",[s._v("需要等待结果返回，才能继续运行就是同步")]),s._v(" "),t("li",[s._v("不需要等待结果返回，就能继续运行就是异步")])]),s._v(" "),t("h4",{attrs:{id:"设计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设计"}},[s._v("#")]),s._v(" 设计")]),s._v(" "),t("p",[s._v("多线程可以让方法执行变为异步的（即不要巴巴干等着）比如说读取磁盘文件时，假设读取操作花费了 5 秒钟，如\n果没有线程调度机制，这 5 秒 cpu 什么都做不了，其它代码都得暂停...")]),s._v(" "),t("h4",{attrs:{id:"结论"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#结论"}},[s._v("#")]),s._v(" 结论")]),s._v(" "),t("ul",[t("li",[s._v("比如在项目中，视频文件需要转换格式等操作比较费时，这时开一个新线程处理视频转换，避免阻塞主线程")]),s._v(" "),t("li",[s._v("tomcat 的异步 servlet 也是类似的目的，让用户线程处理耗时较长的操作，避免阻塞 tomcat 的工作线程")]),s._v(" "),t("li",[s._v("ui 程序中，开线程进行其他操作，避免阻塞 ui 线程")])]),s._v(" "),t("h3",{attrs:{id:"应用之提高效率-案例1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#应用之提高效率-案例1"}},[s._v("#")]),s._v(" "),t("strong",[t("font",{attrs:{color:"red"}},[s._v("应用之提高效率（案例1）")])],1)]),s._v(" "),t("p",[s._v("充分利用多核 cpu 的优势，提高运行效率。想象下面的场景，执行 3 个计算，最后将计算结果汇总。")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("计算 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 花费 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" ms\n    \n计算 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" 花费 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" ms\n    \n计算 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" 花费 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" ms\n    \n汇总需要 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" ms\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[s._v("如果是串行执行，那么总共花费的时间是 10 + 11 + 9 + 1 = "),t("strong",[t("font",{attrs:{color:"red"}},[s._v("31ms")])],1)]),s._v(" "),t("li",[s._v("但如果是四核 cpu，各个核心分别使用线程 1 执行计算 1，线程 2 执行计算 2，线程 3 执行计算 3，那么 3 个线程是并行的，花费时间只取决于最长的那个线程运行的时间，即 "),t("strong",[t("font",{attrs:{color:"red"}},[s._v("11ms")])],1),s._v(" 最后加上汇总时间只会花费 "),t("strong",[t("font",{attrs:{color:"red"}},[s._v("12ms")])],1)])]),s._v(" "),t("blockquote",[t("p",[s._v("注意")]),s._v(" "),t("p",[s._v("需要在多核 cpu 才能提高效率，单核仍然时是轮流执行")])]),s._v(" "),t("h4",{attrs:{id:"设计-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设计-2"}},[s._v("#")]),s._v(" 设计")]),s._v(" "),t("blockquote",[t("p",[t("strong",[t("font",{attrs:{color:"red"}},[s._v(">>>>>代码见【应用之效率-案例1】<<<<<")])],1)])]),s._v(" "),t("h4",{attrs:{id:"结论-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#结论-2"}},[s._v("#")]),s._v(" 结论")]),s._v(" "),t("ol",[t("li",[s._v("单核 cpu 下，多线程不能实际提高程序运行效率，只是为了能够在不同的任务之间切换，不同线程轮流使用\ncpu ，不至于一个线程总占用 cpu，别的线程没法干活")]),s._v(" "),t("li",[s._v("多核 cpu 可以并行跑多个线程，但能否提高程序运行效率还是要分情况的")])]),s._v(" "),t("ul",[t("li",[s._v("有些任务，经过精心设计，将任务拆分，并行执行，当然可以提高程序的运行效率。但不是所有计算任\n务都能拆分（参考后文的【阿姆达尔定律】）")]),s._v(" "),t("li",[s._v("也不是所有任务都需要拆分，任务的目的如果不同，谈拆分和效率没啥意义")])]),s._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[s._v("IO 操作不占用 cpu，只是我们一般拷贝文件使用的是【阻塞 IO】，这时相当于线程虽然不用 cpu，但需要一\n直等待 IO 结束，没能充分利用线程。所以才有后面的【非阻塞 IO】和【异步 IO】优化")])]),s._v(" "),t("h2",{attrs:{id:"java-线程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#java-线程"}},[s._v("#")]),s._v(" Java 线程")]),s._v(" "),t("h3",{attrs:{id:"本章内容"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本章内容"}},[s._v("#")]),s._v(" 本章内容")]),s._v(" "),t("ul",[t("li",[s._v("创建和运行线程")]),s._v(" "),t("li",[s._v("查看线程")]),s._v(" "),t("li",[s._v("线程 API")]),s._v(" "),t("li",[s._v("线程状态")])]),s._v(" "),t("h3",{attrs:{id:"创建和运行线程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建和运行线程"}},[s._v("#")]),s._v(" 创建和运行线程")]),s._v(" "),t("h4",{attrs:{id:"方法一-直接使用-thread"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法一-直接使用-thread"}},[s._v("#")]),s._v(" 方法一，直接使用 Thread")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建线程对象")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 要执行的任务")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 启动线程")]),s._v("\nt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("例如：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 构造方法的参数是给线程指定名字，推荐")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// run 方法内实现了要执行的任务")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("debug")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nt1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("输出:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("ThreadStarter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" hello\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"方法二-使用-runnable-配合-thread"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法二-使用-runnable-配合-thread"}},[s._v("#")]),s._v(" 方法二，使用 Runnable 配合 Thread")]),s._v(" "),t("p",[s._v("把【线程】和【任务】（要执行的代码）分开")]),s._v(" "),t("ul",[t("li",[s._v("Thread 代表线程")]),s._v(" "),t("li",[s._v("Runnable 可运行的任务（线程要执行的代码）")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" runnable "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 要执行的任务")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建线程对象")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" runnable "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 启动线程")]),s._v("\nt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("例如：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建任务对象")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" task2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \tlog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("debug")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 参数1 是任务对象; 参数2 是线程名字，推荐")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" t2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("task2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nt2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("输出:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("ThreadStarter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" hello\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("Java 8 以后可以使用 lambda 精简代码")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建任务对象")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Runnable")]),s._v(" task2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("debug")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 参数1 是任务对象; 参数2 是线程名字，推荐")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" t2 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("task2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nt2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"原理之-thread-与-runnable-的关系"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原理之-thread-与-runnable-的关系"}},[s._v("#")]),s._v(" "),t("strong",[t("font",{attrs:{color:"red"}},[s._v("原理之 Thread 与 Runnable 的关系")])],1)]),s._v(" "),t("p",[s._v("分析 Thread 的源码，理清它与 Runnable 的关系")]),s._v(" "),t("p",[t("strong",[s._v("小结")])]),s._v(" "),t("ul",[t("li",[s._v("方法1 是把线程和任务合并在了一起，方法2 是把线程和任务分开了")]),s._v(" "),t("li",[s._v("用 Runnable 更容易与线程池等高级 API 配合")]),s._v(" "),t("li",[s._v("用 Runnable 让任务类脱离了 Thread 继承体系，更灵活")])]),s._v(" "),t("h4",{attrs:{id:"方法三-futuretask-配合-thread"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法三-futuretask-配合-thread"}},[s._v("#")]),s._v(" 方法三，FutureTask 配合 Thread")]),s._v(" "),t("p",[s._v("FutureTask 能够接收 Callable 类型的参数，用来处理有返回结果的情况")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建任务对象")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FutureTask")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" task3 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FutureTask")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("debug")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 参数1 是任务对象; 参数2 是线程名字，推荐")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("task3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t3"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 主线程阻塞，同步等待 task 执行完毕的结果")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),s._v(" result "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" task3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nlog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("debug")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"结果是:{}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("输出:")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("t3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("ThreadStarter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" hello\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("main"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("ThreadStarter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 结果是"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"观察多个线程同时运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#观察多个线程同时运行"}},[s._v("#")]),s._v(" 观察多个线程同时运行")]),s._v(" "),t("p",[t("strong",[s._v("主要是理解")])]),s._v(" "),t("ul",[t("li",[s._v("交替执行")]),s._v(" "),t("li",[s._v("谁先谁后，不由我们控制")])]),s._v(" "),t("h3",{attrs:{id:"查看进程线程的方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看进程线程的方法"}},[s._v("#")]),s._v(" 查看进程线程的方法")]),s._v(" "),t("h4",{attrs:{id:"windows"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#windows"}},[s._v("#")]),s._v(" windows")]),s._v(" "),t("ul",[t("li",[s._v("任务管理器可以查看进程和线程数，也可以用来杀死进程")]),s._v(" "),t("li",[t("code",[s._v("tasklist")]),s._v(" 查看进程")]),s._v(" "),t("li",[t("code",[s._v("taskkill")]),s._v(" 杀死进程")])]),s._v(" "),t("h4",{attrs:{id:"linux"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#linux"}},[s._v("#")]),s._v(" linux")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("ps -fe")]),s._v(" 查看所有进程")]),s._v(" "),t("li",[t("code",[s._v("ps -fT -p <PID>")]),s._v(" 查看某个进程（PID）的所有线程")]),s._v(" "),t("li",[t("code",[s._v("kill")]),s._v(" 杀死进程")]),s._v(" "),t("li",[t("code",[s._v("top 按大写 H")]),s._v(" 切换是否显示线程")]),s._v(" "),t("li",[t("code",[s._v("top -H -p <PID>")]),s._v(" 查看某个进程（PID）的所有线程")])]),s._v(" "),t("h4",{attrs:{id:"java"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#java"}},[s._v("#")]),s._v(" Java")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("jps")]),s._v(" 命令查看所有 Java 进程")]),s._v(" "),t("li",[t("code",[s._v("jstack <PID>")]),s._v(" 查看某个 Java 进程（PID）的所有线程状态")]),s._v(" "),t("li",[t("code",[s._v("jconsole")]),s._v(" 来查看某个 Java 进程中线程的运行情况（图形界面）")])]),s._v(" "),t("h4",{attrs:{id:"jconsole-远程监控配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jconsole-远程监控配置"}},[s._v("#")]),s._v(" jconsole 远程监控配置")]),s._v(" "),t("ul",[t("li",[s._v("需要以如下方式运行你的 java 类")])]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("java "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Djava")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rmi"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hostname"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("`ip地址` "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Dcom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("management"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jmxremote "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Dcom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("management"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jmxremote"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("`连接端口` "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Dcom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("management"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jmxremote"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ssl"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("是否安全连接 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Dcom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sun"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("management"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jmxremote"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authenticate"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("是否认证 java类\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("修改 /etc/hosts 文件将 127.0.0.1 映射至主机名")])]),s._v(" "),t("p",[t("strong",[s._v("如果要认证访问，还需要做如下步骤")])]),s._v(" "),t("ul",[t("li",[s._v("复制 jmxremote.password 文件")]),s._v(" "),t("li",[s._v("修改 jmxremote.password 和 jmxremote.access 文件的权限为 600 即文件所有者可读写")]),s._v(" "),t("li",[s._v("连接时填入 controlRole（用户名），R&D（密码）")])]),s._v(" "),t("h3",{attrs:{id:"原理之线程运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原理之线程运行"}},[s._v("#")]),s._v(" "),t("strong",[t("font",{attrs:{color:"red"}},[s._v("原理之线程运行")])],1)]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("cn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("itcast"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("n3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TestFrames")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("method1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("start")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("method1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("method1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" y "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" m "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("method2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("method2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" n "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2022/01/13/Ye6QgbiGA5UEHdr.png",alt:"image-20220113134616321"}})]),s._v(" "),t("h4",{attrs:{id:"栈与栈帧"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#栈与栈帧"}},[s._v("#")]),s._v(" 栈与栈帧")]),s._v(" "),t("p",[s._v("Java Virtual Machine Stacks （Java 虚拟机栈）")]),s._v(" "),t("p",[s._v("我们都知道 JVM 中由堆、栈、方法区所组成，其中栈内存是给谁用的呢？其实就是线程，每个线程启动后，虚拟\n机就会为其分配一块栈内存。")]),s._v(" "),t("ul",[t("li",[s._v("每个栈由多个栈帧（Frame）组成，对应着每次方法调用时所占用的内存")]),s._v(" "),t("li",[s._v("每个线程只能有一个活动栈帧，对应着当前正在执行的那个方法")])]),s._v(" "),t("h4",{attrs:{id:"线程上下文切换-thread-context-switch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#线程上下文切换-thread-context-switch"}},[s._v("#")]),s._v(" 线程上下文切换（Thread Context Switch）")]),s._v(" "),t("p",[s._v("因为以下一些原因导致 cpu 不再执行当前的线程，转而执行另一个线程的代码")]),s._v(" "),t("ul",[t("li",[s._v("线程的 cpu 时间片用完")]),s._v(" "),t("li",[s._v("垃圾回收")]),s._v(" "),t("li",[s._v("有更高优先级的线程需要运行")]),s._v(" "),t("li",[s._v("线程自己调用了 sleep、yield、wait、join、park、synchronized、lock 等方法")])]),s._v(" "),t("p",[s._v("当 Context Switch 发生时，需要由操作系统保存当前线程的状态，并恢复另一个线程的状态，Java 中对应的概念\n就是程序计数器（Program Counter Register），它的作用是记住下一条 jvm 指令的执行地址，是线程私有的")]),s._v(" "),t("ul",[t("li",[s._v("状态包括程序计数器、虚拟机栈中每个栈帧的信息，如局部变量、操作数栈、返回地址等")]),s._v(" "),t("li",[s._v("Context Switch 频繁发生会影响性能")])]),s._v(" "),t("p",[s._v("示例：")]),s._v(" "),t("p",[t("video",{attrs:{src:"C:/Users/Administrator/Videos/Captures/juc-%E7%BA%BF%E7%A8%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2.mp4"}})]),s._v(" "),t("h3",{attrs:{id:"常见方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见方法"}},[s._v("#")]),s._v(" 常见方法")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2022/01/13/oKpsYDeU7T5kBvC.png",alt:"image-20220113144154670"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2022/01/13/prFUNYLMIndtcAZ.png",alt:"image-20220113144215674"}})]),s._v(" "),t("h3",{attrs:{id:"start-与-run"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#start-与-run"}},[s._v("#")]),s._v(" start 与 run")]),s._v(" "),t("h4",{attrs:{id:"调用-run"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调用-run"}},[s._v("#")]),s._v(" 调用 run")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),s._v(" t1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"t1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("debug")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Thread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("currentThread")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FileReader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("read")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Constants")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("MP4_FULL_PATH")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("debug")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"do other things ..."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("输出")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("19:39:14 [main] c.TestStart - main\n19:39:14 [main] c.FileReader - read [1.mp4] start ...\n19:39:18 [main] c.FileReader - read [1.mp4] end ... cost: 4227 ms\n19:39:18 [main] c.TestStart - do other things ...\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("程序仍在 main 线程运行， "),t("strong",[t("font",{attrs:{color:"red"}},[s._v("FileReader.read()")])],1),s._v(" 方法调用还是同步的")]),s._v(" "),t("h4",{attrs:{id:"调用-start"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调用-start"}},[s._v("#")]),s._v(" 调用 start")]),s._v(" "),t("p",[s._v("将上述代码的 "),t("strong",[t("font",{attrs:{color:"red"}},[s._v("t1.run()")])],1),s._v(" 改为")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("t1.start();\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("输出")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("19:41:30 [main] c.TestStart - do other things ...\n19:41:30 [t1] c.TestStart - t1\n19:41:30 [t1] c.FileReader - read [1.mp4] start ...\n19:41:35 [t1] c.FileReader - read [1.mp4] end ... cost: 4542 ms\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("程序在 t1 线程运行， "),t("strong",[t("font",{attrs:{color:"red"}},[s._v("FileReader.read()")])],1),s._v(" 方法调用是异步的")]),s._v(" "),t("h4",{attrs:{id:"小结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),t("ul",[t("li",[s._v("直接调用 run 是在主线程中执行了 run，没有启动新的线程")]),s._v(" "),t("li",[s._v("使用 start 是启动新的线程，通过新的线程间接执行 run 中的代码")])]),s._v(" "),t("h3",{attrs:{id:"sleep-与-yield"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sleep-与-yield"}},[s._v("#")]),s._v(" sleep 与 yield")]),s._v(" "),t("h4",{attrs:{id:"sleep"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sleep"}},[s._v("#")]),s._v(" sleep")]),s._v(" "),t("ol",[t("li",[s._v("调用 sleep 会让当前线程从 Running 进入 Timed Waiting 状态（阻塞）")]),s._v(" "),t("li",[s._v("其它线程可以使用 interrupt 方法打断正在睡眠的线程，这时 sleep 方法会抛出 InterruptedException")]),s._v(" "),t("li",[s._v("睡眠结束后的线程未必会立刻得到执行")]),s._v(" "),t("li",[s._v("建议用 TimeUnit 的 sleep 代替 Thread 的 sleep 来获得更好的可读性")])]),s._v(" "),t("h4",{attrs:{id:"yield"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#yield"}},[s._v("#")]),s._v(" yield")]),s._v(" "),t("ol",[t("li",[s._v("调用 yield 会让当前线程从 Running 进入 Runnable 就绪状态，然后调度执行其它线程")]),s._v(" "),t("li",[s._v("具体的实现依赖于操作系统的任务调度器（并不一定让的出去 要看当前是否有别的线程要运行）")])]),s._v(" "),t("h4",{attrs:{id:"sleep-与-yield区别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sleep-与-yield区别"}},[s._v("#")]),s._v(" sleep 与 yield区别")]),s._v(" "),t("ol",[t("li",[s._v("sleep 从 Running 进入 Timed Waiting 状态（阻塞）不能被重新安排调度")]),s._v(" "),t("li",[s._v("yield 会让当前线程从 Running 进入 Runnable 就绪状态 可以重新被安排调度")])]),s._v(" "),t("h4",{attrs:{id:"线程优先级"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#线程优先级"}},[s._v("#")]),s._v(" 线程优先级")]),s._v(" "),t("ul",[t("li",[s._v("线程优先级会提示（hint）调度器优先调度该线程，但它仅仅是一个提示，调度器可以忽略它")]),s._v(" "),t("li",[s._v("如果 cpu 比较忙，那么优先级高的线程会获得更多的时间片，但 cpu 闲时，优先级几乎没作用")])]),s._v(" "),t("div",{staticClass:"language-- java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('package cn.itcast.n3;\n\nimport lombok.extern.slf4j.Slf4j;\n\n@Slf4j(topic = "c.TestYield")\npublic class TestYield {\n    public static void main(String[] args) {\n        Runnable task1 = () -> {\n            int count = 0;\n            for (;;) {\n                System.out.println("----\x3e1 " + count++);\n            }\n        };\n        Runnable task2 = () -> {\n            int count = 0;\n            for (;;) {\n//                Thread.yield();\n                System.out.println("              ----\x3e2 " + count++);\n            }\n        };\n        Thread t1 = new Thread(task1, "t1");\n        Thread t2 = new Thread(task2, "t2");\n        t1.setPriority(Thread.MIN_PRIORITY);\n        t2.setPriority(Thread.MAX_PRIORITY);\n        t1.start();\n        t2.start();\n    }\n\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("h3",{attrs:{id:"线程状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#线程状态"}},[s._v("#")]),s._v(" 线程状态")]),s._v(" "),t("ol",[t("li",[s._v("初始(NEW)：新创建了一个线程对象，但还没有调用start()方法。")]),s._v(" "),t("li",[s._v("运行(RUNNABLE)：Java线程中将就绪（ready）和运行中（running）两种状态笼统的称为“运行”。\n线程对象创建后，其他线程(比如main线程）调用了该对象的start()方法。该状态的线程位于可运行线程池中，等待被线程调度选中，获取CPU的使用权，此时处于就绪状态（ready）。就绪状态的线程在获得CPU时间片后变为运行中状态（running）。")]),s._v(" "),t("li",[s._v("阻塞(BLOCKED)：表示线程阻塞于锁。")]),s._v(" "),t("li",[s._v("等待(WAITING)：进入该状态的线程需要等待其他线程做出一些特定动作（通知或中断）。")]),s._v(" "),t("li",[s._v("超时等待(TIMED_WAITING)：该状态不同于WAITING，它可以在指定的时间后自行返回。")]),s._v(" "),t("li",[s._v("终止(TERMINATED)：表示该线程已经执行完毕。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2022/02/08/XqtPcFYjzVaQyvs.jpg",alt:"线程状态图"}})]),s._v(" "),t("h3",{attrs:{id:"synchronized-位置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#synchronized-位置"}},[s._v("#")]),s._v(" synchronized 位置")]),s._v(" "),t("p",[t("strong",[s._v("1、对于静态方法，由于此时对象还未生成，所以只能采用类锁；")])]),s._v(" "),t("p",[t("strong",[s._v("2、只要采用类锁，就会拦截所有线程，只能让一个线程访问。")])]),s._v(" "),t("p",[t("strong",[s._v("3、对于对象锁（this），如果是同一个实例，就会按顺序访问，但是如果是不同实例，就可以同时访问")])]),s._v(" "),t("p",[t("strong",[s._v("4、如果对象锁跟访问的对象没有关系，那么就会都同时访问。")])])])}),[],!1,null,null,null);t.default=e.exports}}]);